[gd_scene load_steps=44 format=3 uid="uid://di8bojp8w0r88"]

[ext_resource type="Script" path="res://scripts/placeable/player.gd" id="1_s62gp"]
[ext_resource type="Texture2D" uid="uid://dc4fl0tw6qa41" path="res://sprites/knight-final-top-half-90x36-Sheet.png" id="2_8m05b"]
[ext_resource type="Texture2D" uid="uid://v1wftaebrqwp" path="res://sprites/knight-final-90x36-Sheet.png" id="2_ytfcl"]
[ext_resource type="Script" path="res://scripts/placeable/RoomDetector.gd" id="3_0ed2m"]
[ext_resource type="Texture2D" uid="uid://bnw6qsinnrdh" path="res://sprites/knight-final-bottom-half-90x36-Sheet.png" id="4_s44aa"]
[ext_resource type="Texture2D" uid="uid://cmfu7x0fdldyf" path="res://sprites/progress_bar_textures/health_bar/health-bar-under-20x5.png" id="6_516xt"]
[ext_resource type="Texture2D" uid="uid://blaij2o6hcbrg" path="res://sprites/progress_bar_textures/health_bar/health-bar-progress-20x5.png" id="7_fcfru"]

[sub_resource type="AtlasTexture" id="AtlasTexture_ouijc"]
atlas = ExtResource("2_8m05b")
region = Rect2(720, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_ui33q"]
atlas = ExtResource("2_8m05b")
region = Rect2(810, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_6omy5"]
atlas = ExtResource("2_8m05b")
region = Rect2(900, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_gn4p0"]
atlas = ExtResource("2_ytfcl")
region = Rect2(990, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_ink88"]
atlas = ExtResource("2_ytfcl")
region = Rect2(1080, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_dyxtx"]
atlas = ExtResource("2_ytfcl")
region = Rect2(1170, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_pnwyh"]
atlas = ExtResource("2_ytfcl")
region = Rect2(1260, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_2op5t"]
atlas = ExtResource("2_8m05b")
region = Rect2(0, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_wyqqd"]
atlas = ExtResource("2_8m05b")
region = Rect2(90, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_l5oen"]
atlas = ExtResource("2_ytfcl")
region = Rect2(1260, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_p6ldo"]
atlas = ExtResource("2_ytfcl")
region = Rect2(1170, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_ceel2"]
atlas = ExtResource("2_ytfcl")
region = Rect2(1080, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_qaqq7"]
atlas = ExtResource("2_ytfcl")
region = Rect2(990, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_3ypa4"]
atlas = ExtResource("2_8m05b")
region = Rect2(180, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_gfycd"]
atlas = ExtResource("2_8m05b")
region = Rect2(270, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_l7wkg"]
atlas = ExtResource("2_8m05b")
region = Rect2(360, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_606t2"]
atlas = ExtResource("2_8m05b")
region = Rect2(450, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_cafmp"]
atlas = ExtResource("2_8m05b")
region = Rect2(540, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_3lb0t"]
atlas = ExtResource("2_8m05b")
region = Rect2(630, 0, 90, 36)

[sub_resource type="SpriteFrames" id="SpriteFrames_vcljs"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_ouijc")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ui33q")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_6omy5")
}],
"loop": false,
"name": &"attack",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_gn4p0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ink88")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dyxtx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_pnwyh")
}],
"loop": false,
"name": &"death",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_2op5t")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wyqqd")
}],
"loop": true,
"name": &"idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_l5oen")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_p6ldo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ceel2")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qaqq7")
}],
"loop": false,
"name": &"respawn",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_3ypa4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gfycd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_l7wkg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_606t2")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cafmp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_3lb0t")
}],
"loop": true,
"name": &"run",
"speed": 10.0
}]

[sub_resource type="AtlasTexture" id="AtlasTexture_qeu8s"]
atlas = ExtResource("4_s44aa")
region = Rect2(720, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_bcc3p"]
atlas = ExtResource("4_s44aa")
region = Rect2(810, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_hante"]
atlas = ExtResource("4_s44aa")
region = Rect2(900, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_e84mk"]
atlas = ExtResource("4_s44aa")
region = Rect2(0, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_xb1tu"]
atlas = ExtResource("4_s44aa")
region = Rect2(90, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_k431d"]
atlas = ExtResource("4_s44aa")
region = Rect2(180, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_s1cwe"]
atlas = ExtResource("4_s44aa")
region = Rect2(270, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_2of3g"]
atlas = ExtResource("4_s44aa")
region = Rect2(360, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_65muw"]
atlas = ExtResource("4_s44aa")
region = Rect2(450, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_hnik2"]
atlas = ExtResource("4_s44aa")
region = Rect2(540, 0, 90, 36)

[sub_resource type="AtlasTexture" id="AtlasTexture_xrvbi"]
atlas = ExtResource("4_s44aa")
region = Rect2(630, 0, 90, 36)

[sub_resource type="SpriteFrames" id="SpriteFrames_0cdcd"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_qeu8s")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_bcc3p")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hante")
}],
"loop": false,
"name": &"attack",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_e84mk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xb1tu")
}],
"loop": true,
"name": &"idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_k431d")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_s1cwe")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2of3g")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_65muw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hnik2")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xrvbi")
}],
"loop": true,
"name": &"run",
"speed": 10.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_826fu"]
size = Vector2(13, 19)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_5u5iw"]
size = Vector2(17, 22)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_tkdcx"]
size = Vector2(51, 21)

[sub_resource type="CircleShape2D" id="CircleShape2D_iy7w6"]
radius = 5.09902

[node name="player" type="CharacterBody2D"]
y_sort_enabled = true
collision_layer = 4
collision_mask = 258
script = ExtResource("1_s62gp")

[node name="TopHalf" type="AnimatedSprite2D" parent="."]
unique_name_in_owner = true
position = Vector2(1, -16)
sprite_frames = SubResource("SpriteFrames_vcljs")
animation = &"respawn"
autoplay = "idle"

[node name="BottomHalf" type="AnimatedSprite2D" parent="."]
unique_name_in_owner = true
z_index = -1
position = Vector2(1, -16)
sprite_frames = SubResource("SpriteFrames_0cdcd")
animation = &"idle"
autoplay = "idle"

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -8)
shape = SubResource("RectangleShape2D_826fu")

[node name="InvinciblityTimer" type="Timer" parent="."]
unique_name_in_owner = true
one_shot = true

[node name="AttackCooldownTimer" type="Timer" parent="."]
unique_name_in_owner = true
wait_time = 0.3
one_shot = true

[node name="RegenStartTimer" type="Timer" parent="."]
unique_name_in_owner = true
one_shot = true

[node name="RegenTimer" type="Timer" parent="."]
unique_name_in_owner = true
wait_time = 5.0

[node name="HealthBarVisibleTimer" type="Timer" parent="."]
unique_name_in_owner = true
wait_time = 3.0
one_shot = true

[node name="RespawnTimer" type="Timer" parent="."]
unique_name_in_owner = true
one_shot = true

[node name="GameOverTimer" type="Timer" parent="."]
unique_name_in_owner = true
wait_time = 5.0

[node name="PlayerHitbox" type="Area2D" parent="."]
position = Vector2(-0.5, -8)
collision_layer = 32
monitoring = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="PlayerHitbox"]
shape = SubResource("RectangleShape2D_5u5iw")

[node name="DamagerHitbox" type="Area2D" parent="."]
unique_name_in_owner = true
position = Vector2(-12.5, -17.5)
collision_layer = 128
collision_mask = 64
monitorable = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="DamagerHitbox"]
shape = SubResource("RectangleShape2D_tkdcx")

[node name="RoomDetector" type="Area2D" parent="."]
position = Vector2(-1, -11)
collision_layer = 0
collision_mask = 2048
script = ExtResource("3_0ed2m")

[node name="CollisionShape2D" type="CollisionShape2D" parent="RoomDetector"]
shape = SubResource("CircleShape2D_iy7w6")

[node name="health_bar" type="TextureProgressBar" parent="."]
unique_name_in_owner = true
visible = false
z_index = 50
z_as_relative = false
offset_left = -10.0
offset_top = -40.0
offset_right = 10.0
offset_bottom = -35.0
step = 10.0
value = 100.0
texture_under = ExtResource("6_516xt")
texture_progress = ExtResource("7_fcfru")

[connection signal="animation_finished" from="TopHalf" to="." method="_on_top_half_animation_finished"]
[connection signal="timeout" from="InvinciblityTimer" to="." method="_on_invinciblity_timer_timeout"]
[connection signal="timeout" from="AttackCooldownTimer" to="." method="_on_attack_cooldown_timer_timeout"]
[connection signal="timeout" from="RegenStartTimer" to="." method="_on_regen_start_timer_timeout"]
[connection signal="timeout" from="RegenTimer" to="." method="_on_regen_timer_timeout"]
[connection signal="timeout" from="HealthBarVisibleTimer" to="." method="_on_health_bar_visible_timer_timeout"]
[connection signal="timeout" from="RespawnTimer" to="." method="_on_respawn_timer_timeout"]
[connection signal="timeout" from="GameOverTimer" to="." method="_on_game_over_timer_timeout"]
[connection signal="area_entered" from="RoomDetector" to="RoomDetector" method="_on_new_room_entered"]
[connection signal="area_exited" from="RoomDetector" to="RoomDetector" method="_on_room_exited"]
